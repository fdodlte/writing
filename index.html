
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escribe o Muere</title>
  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      background-color: #0a0a0a;
      font-family: 'Courier New', monospace;
      color: white;
      height: 100%;
      overflow: hidden;
    }
    .center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    #intro {
      margin-bottom: 20px;
      font-size: 18px;
    }
    input[type="email"] {
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      outline: none;
      margin-right: 10px;
      width: 220px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #3a4b78;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
    #timer {
      font-size: 24px;
      margin: 10px;
      display: none;
      position: absolute;
      top: 10px;
      right: 20px;
      color: #ccc;
      z-index: 2;
    }
    #progressBarContainer {
      position: absolute;
      top: 0;
      left: 0;
      height: 4px;
      width: 100%;
      background: #333;
      z-index: 1;
    }
    #progressBar {
      height: 100%;
      width: 100%;
      background: #3a4b78;
      transition: width 1s linear;
    }
    #editor {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      color: white;
      border: none;
      outline: none;
      padding: 20px;
      font-size: 20px;
      font-family: 'Courier New', monospace;
      resize: none;
      display: none;
      z-index: 1;
      line-height: 1.6;
    }
    #saveBtn {
      display: none;
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 2;
    }
    footer {
      position: absolute;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 12px;
      color: #777;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div class="center">
    <div id="intro">Este ritual me cambió la vida. Tal vez a ti también.</div>
    <input type="email" id="emailInput" placeholder="Tu correo">
    
    <button id="startBtn">Empezar</button>
    <label title="Modo Hard" style="margin-left:10px; cursor:pointer;">
      <input type="checkbox" id="hardmode" style="display:none;">
      
    <span id="hardLabel" style="border:1px solid #3a4b78; padding:3px 6px; border-radius:4px; font-size:12px; color:#3a4b78;">
      Hard
    </span>
    <script>
      document.getElementById("hardmode").addEventListener("change", function() {
        document.getElementById("hardLabel").style.backgroundColor = this.checked ? "#3a4b78" : "transparent";
        document.getElementById("hardLabel").style.color = this.checked ? "white" : "#3a4b78";
      });
    </script>
    
    </label>
    
  </div>

  <div id="progressBarContainer">
    <div id="progressBar"></div>
  </div>

  <div id="timer" style="display:none;">5:00</div>
  <textarea id="editor" placeholder=""></textarea>
  <button id="saveBtn">Guardar texto</button>

  <footer>por Fernando</footer>

  <script>
    const startBtn = document.getElementById("startBtn");
    const emailInput = document.getElementById("emailInput");
    const editor = document.getElementById("editor");
    const timer = document.getElementById("timer");
    const saveBtn = document.getElementById("saveBtn");
    const progressBar = document.getElementById("progressBar");

    let countdown = 300;
    let idleTime = 0;
    let timerInterval, idleInterval;
    let running = false;

    function updateTimer() {
      let min = Math.floor(countdown / 60);
      let sec = countdown % 60;
      timer.textContent = min + ":" + (sec < 10 ? "0" + sec : sec);

      let progress = (countdown / 300) * 100;
      progressBar.style.width = progress + "%";

      if (countdown <= 0) {
        clearInterval(timerInterval);
        clearInterval(idleInterval);
        editor.disabled = true;
        saveBtn.style.display = "inline-block";
        running = false;
      }

      countdown--;
    }

    function resetAndStart() {
      countdown = 300;
      idleTime = 0;
      editor.value = "";
      timer.textContent = "5:00";
      progressBar.style.width = "100%";
      clearInterval(timerInterval);
      clearInterval(idleInterval);
      timerInterval = setInterval(updateTimer, 1000);
      idleInterval = setInterval(checkIdle, 1000);
      running = true;
    }

    function checkIdle() {
      idleTime++;
      if (idleTime >= 5) {
        resetAndStart();
      }
    }

    startBtn.onclick = () => {
      const email = emailInput.value;
      if (!email.includes("@")) {
        alert("Correo inválido.");
        return;
      }

      startBtn.disabled = true;
      emailInput.disabled = true;
      document.querySelector(".center").style.display = "none";
      
    editor.style.display = "block";
    const hardmodeEnabled = document.getElementById("hardmode").checked;
    if (hardmodeEnabled) {
      document.getElementById("blurOverlay").style.display = "block";
    }
    
      // timer.style.display = "block";
      editor.disabled = false;
      editor.focus();
      resetAndStart();
    };

    editor.addEventListener("input", () => {
      idleTime = 0;
      if (!running) {
        resetAndStart();
      }
    });

    saveBtn.onclick = () => {
      const blob = new Blob([editor.value], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "escritura.txt";
      link.click();
    };
  </script>

    <div id="blurOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; backdrop-filter: blur(6px); z-index:1;"></div>
    </body>
    
</html>
